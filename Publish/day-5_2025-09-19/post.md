---
title: "玩家行為實做 ( 5% AI）"
date: 2025-09-19
category: ironman-2025
slug: post-2025_09_19-day5-玩家行為實做-5-ai
day: 5
---

# Day5 - 玩家行為實做 ( < 5% AI）


昨天分享了我們的狀態機框架，接下來是實做的玩家角色的控制和移動部分。

首先是靜態配置和動態參數，包括攻擊、位移、翻滾的配置，以及運行時狀態的參數，如行動意圖、移動請求等。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87.png)

玩家狀態實做，包括玩家能做的閒置、攻擊、翻滾、移動、投擲等行為都有一個專屬狀態。狀態會根據配置和動態參數，再把計算結果寫回另一個動態參數，但本身不「執行」攻擊傷害輸出或移動。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%201.png)

例如在 Run 和 Doge State 的 Tick 中，狀態只會把移動請求寫入 MovementRuntime 中的參數，但並不會實際執行物件在世界中的 Transform Position 的移動行為。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%202.png)

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%203.png)

實際的動作我擊我交給 Addon ，讓一個 RigidbodyMover Addon 讀取動態參數中的移動請求後，再傳遞給 Unity Rigidbody 執行移動。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%204.png)

玩家輸入則透過一個轉換器，把輸入資訊轉換成狀態機參數中的「行為意圖」，代表狀態機決策大腦大腦下達的指令。原本是獨立的轉換器，後來也把它改成 Addon 了。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%205.png)

轉換條件實做，讀取配置和動態參數判斷條件是否符合。包括檢查是否進入移動狀態、是否有翻滾意圖、是否有攻擊意圖和當前狀態是否結束等。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%206.png)

最後用一個 Builder 模式組裝出整個狀態機！傳入需要的 Config、建立動態參數、設置狀態與轉換條件、掛上需要的 Addon，然後就組裝出我們需要的角色狀態機了。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%207.png)

這個狀態機是完全模組化的，要擴展或替換某部分都很容易，而雖然現在是用程式組裝，但只要寫個轉換器就能用 ScriptableObject 或其他純資料格式組裝。

狀態機運作就交給一個 MonoBehavior 的 Driver 執行，可以選擇要在 Update 還是 FixedUpdate 調用 Tick 更新。

![圖片.png](Day5%20-%20%E7%8E%A9%E5%AE%B6%E8%A1%8C%E7%82%BA%E5%AF%A6%E5%81%9A%20(%205%25%20AI%EF%BC%89%2026864707f2db80e39380f6822cba8359/%E5%9C%96%E7%89%87%208.png)

至於運做起來的樣子就等下篇，跟狀態機除錯一起講 :P